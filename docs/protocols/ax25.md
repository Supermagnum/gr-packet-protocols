# AX.25 Protocol Documentation

AX.25 (Amateur X.25) is a data link layer protocol used in amateur radio packet communications. This document provides comprehensive information about the AX.25 implementation in gr-packet-protocols.

## Protocol Overview

AX.25 is based on the X.25 protocol but adapted for amateur radio use. It provides reliable data transmission over radio links with features like:

- **Frame Types**: Information (I), Supervisory (S), and Unnumbered (U) frames
- **Addressing**: Callsign-based addressing with SSID support
- **Error Detection**: Frame Check Sequence (FCS) for error detection
- **Flow Control**: Sliding window protocol for reliable transmission
- **Digipeating**: Multi-hop packet routing

## Frame Structure

### Basic AX.25 Frame
```
| Flag | Addresses | Control | PID | Information | FCS | Flag |
| 0x7E | 14+ bytes | 1 byte  | 1   | 0-256 bytes | 2   | 0x7E |
```

### Address Field
```
| Destination | Source | Digipeaters | C/R | H | SSID |
| 6 bytes     | 6 bytes| 0-8 Ã— 7 bytes| 1   | 1 | 4    |
```

### Control Field Types

#### Information Frames (I-frames)
- **Format**: `0xxxxxxx` (x = sequence numbers)
- **Purpose**: Carry user data
- **Fields**: N(S) - Send sequence, N(R) - Receive sequence, P/F - Poll/Final

#### Supervisory Frames (S-frames)
- **Format**: `10xxxxxx`
- **Types**:
  - RR (Receive Ready): `10000000`
  - RNR (Receive Not Ready): `10100000`
  - REJ (Reject): `10010000`
  - SREJ (Selective Reject): `10110000`

#### Unnumbered Frames (U-frames)
- **Format**: `11xxxxxx`
- **Types**:
  - SABM (Set Asynchronous Balanced Mode): `00101111`
  - DISC (Disconnect): `01000011`
  - UA (Unnumbered Acknowledgment): `01100011`
  - DM (Disconnected Mode): `00001111`

## Implementation Details

### Encoder Features
- **Address Handling**: Automatic callsign formatting and SSID management
- **Frame Construction**: Proper frame assembly with FCS calculation
- **Bit Stuffing**: Automatic bit stuffing for flag transparency
- **Digipeater Support**: Multi-hop routing capability

### Decoder Features
- **Frame Detection**: Flag detection and frame boundary identification
- **Address Parsing**: Callsign extraction and validation
- **Error Detection**: FCS verification and frame validation
- **Bit Unstuffing**: Automatic bit unstuffing

### KISS TNC Interface
- **Frame Escaping**: FEND/FESC escaping for data transparency
- **Command Processing**: TNC command interpretation
- **Port Management**: Multi-port TNC support
- **Hardware Interface**: USB CDC and TCP/IP support

## Configuration Parameters

### Encoder Parameters
```python
# Basic addressing
dest_callsign = "APRS"      # Destination callsign
src_callsign = "N0CALL"     # Source callsign
ssid = 0                    # Secondary Station ID (0-15)

# Frame control
control_field = 0x03        # UI frame (Unnumbered Information)
pid = 0xF0                  # Protocol ID (0xF0 = no layer 3)

# Advanced options
command_response = False    # C/R bit
has_been_repeated = False   # H bit
digipeaters = []            # List of digipeater callsigns
```

### Decoder Parameters
```python
# Decoding options
validate_fcs = True         # Enable FCS validation
strict_mode = False         # Strict frame validation
timeout_ms = 1000          # Frame timeout
max_frame_length = 256     # Maximum frame size
```

## Usage Examples

### Basic APRS Position Report
```python
from gnuradio import gr, packet_protocols

# Create encoder
encoder = packet_protocols.ax25_encoder()
encoder.set_dest_callsign("APRS")
encoder.set_src_callsign("N0CALL-1")
encoder.set_ssid(1)
encoder.set_control_field(0x03)  # UI frame
encoder.set_pid(0xF0)            # No layer 3

# APRS position data
position_data = "!4903.50N/07201.75W-Test"
encoder.set_info_field(position_data)
```

### Data Transmission with Acknowledgment
```python
# I-frame for data transmission
encoder.set_control_field(0x00)  # I-frame
encoder.set_pid(0xCC)             # AX.25 text
encoder.set_ns(0)                 # Send sequence number
encoder.set_nr(0)                 # Receive sequence number
encoder.set_poll_final(False)     # P/F bit
```

### Digipeater Path
```python
# Multi-hop routing
digipeaters = ["WIDE1-1", "WIDE2-1"]
encoder.set_digipeaters(digipeaters)
encoder.set_digipeater_ssids([1, 1])
```

## Error Handling

### Common Errors
1. **Invalid Callsign**: Callsign must be 1-6 characters, alphanumeric
2. **SSID Range**: SSID must be 0-15
3. **Frame Length**: Maximum 256 bytes for information field
4. **FCS Mismatch**: Frame Check Sequence validation failure

### Error Recovery
- **Automatic Retry**: Built-in retry mechanism for failed transmissions
- **Timeout Handling**: Configurable timeouts for frame acknowledgment
- **Error Reporting**: Detailed error codes for troubleshooting

## Performance Considerations

### Throughput
- **Theoretical Maximum**: ~1200 bps (1200 baud)
- **Practical Throughput**: ~800-1000 bps (accounting for overhead)
- **Efficiency**: ~70-80% (protocol overhead)

### Latency
- **Frame Processing**: <1ms per frame
- **Network Latency**: Depends on digipeater path
- **Timeout Values**: Configurable (typically 1-3 seconds)

## Standards Compliance

### ITU-T Recommendations
- **X.25**: Base protocol specification
- **X.25.1**: Physical layer interface
- **X.25.2**: Data link layer procedures

### Amateur Radio Standards
- **ARRL**: American Radio Relay League guidelines
- **IARU**: International Amateur Radio Union standards
- **Local Regulations**: Country-specific amateur radio rules

## Security Considerations

### Authentication
- **Callsign Validation**: Source callsign verification
- **SSID Management**: Secondary Station ID security
- **Digipeater Trust**: Trusted digipeater validation

### Privacy
- **Data Encryption**: Not supported in standard AX.25
- **Address Privacy**: Callsigns are transmitted in clear text
- **Traffic Analysis**: Frame patterns may reveal communication patterns

## Troubleshooting

### Common Issues
1. **Frame Not Decoded**: Check FCS and frame format
2. **Address Mismatch**: Verify callsign formatting
3. **Timeout Errors**: Adjust timeout parameters
4. **Digipeater Issues**: Check digipeater configuration

### Debug Tools
- **Frame Analyzer**: Built-in frame analysis tools
- **Logging**: Comprehensive logging for debugging
- **Statistics**: Performance and error statistics

## References

- **AX.25 Protocol Specification**: [ARRL AX.25 Documentation](https://www.arrl.org/ax25)
- **GNU Radio Documentation**: [GNU Radio Manual](https://www.gnuradio.org/doc/doxygen/)
- **Amateur Radio Standards**: [IARU Technical Standards](https://www.iaru.org/)
